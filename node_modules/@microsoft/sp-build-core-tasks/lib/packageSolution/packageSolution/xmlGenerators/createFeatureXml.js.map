{"version":3,"sources":["packageSolution/packageSolution/xmlGenerators/createFeatureXml.ts"],"names":[],"mappings":"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","file":"packageSolution/packageSolution/xmlGenerators/createFeatureXml.js","sourcesContent":["/**\r\n * @file createFeatureXml.ts\r\n * @Copyright (c) Microsoft Corporation.  All rights reserved.\r\n *\r\n * Creates an package's Feature.Xml\r\n */\r\n\r\nimport * as XmlGenerator from 'xml';\r\nimport { merge } from 'lodash';\r\n\r\nimport createRelationshipsXml, { IRelationship } from './createRelationshipsXml';\r\nimport createComponentXml from './createComponentXml';\r\nimport { readSharepointAssets } from '../utils/readSharepointAssets';\r\nimport IFeature from '../models/packageDefinition/IFeature';\r\nimport IComponent from '../models/packageDefinition/IComponent';\r\nimport IResources from '../models/packageXml/IResources';\r\nimport IFeatureXml from '../models/packageXml/IFeatureXml';\r\nimport { ISharepointAssets } from '../models/packageXml/ISharepointAssets';\r\nimport IXml from '../models/packageXml/IXml';\r\nimport IOpenDocumentConventionXml from '../models/packageXml/IOpenDocumentConventionXml';\r\nimport serializationOptions from './serializationOptions';\r\n\r\nexport default function createFeatureXml(feature: IFeature, resources: IResources): IFeatureXml {\r\n  feature = merge({\r\n    version: '1.0.0.0'\r\n  }, feature) as IFeature;\r\n\r\n  const featureXmlFile: string = `feature_${feature.id}.xml`;\r\n\r\n  const featureXml: IOpenDocumentConventionXml = {\r\n    filename: featureXmlFile,  // ensure this is unique\r\n    /* tslint:disable:no-null-keyword */\r\n    relationships: null,\r\n    /* tslint:enable:no-null-keyword */\r\n    xml: XmlGenerator({\r\n      Feature: [\r\n        {\r\n          _attr: {\r\n            xmlns: 'http://schemas.microsoft.com/sharepoint/',\r\n            Title: feature.title,\r\n            Description: feature.description,\r\n            Id: feature.id,\r\n            Version: feature.version,\r\n            Scope: 'Web', // @todo change to Site scope\r\n            Hidden: 'FALSE'\r\n          }\r\n        }\r\n      ]\r\n    }, serializationOptions)\r\n  };\r\n\r\n  const configXml: IXml = {\r\n    filename: `${featureXmlFile}.config.xml`,\r\n    xml: XmlGenerator({\r\n      AppPartConfig: [\r\n        {\r\n          _attr: {\r\n            xmlns: 'http://schemas.microsoft.com/sharepoint/2012/app/partconfiguration'\r\n          }\r\n        },\r\n        {\r\n          Id: feature.id // @todo needs to be a unique id, different from feature.id\r\n        }\r\n      ]\r\n    }, serializationOptions)\r\n  };\r\n\r\n  const componentsXml: IXml[] = feature.components.map((component: IComponent) => {\r\n    return createComponentXml(component, feature.id);\r\n  });\r\n\r\n  // tslint:disable-next-line:max-line-length\r\n  const assets: ISharepointAssets<IXml> = readSharepointAssets(feature.assets, feature.id);\r\n\r\n  const relationshipsXml: IXml = createRelationshipsXml(featureXmlFile,\r\n        [\r\n          {\r\n            type: 'partconfiguration',\r\n            target: configXml.filename\r\n          } as IRelationship\r\n        ].concat(\r\n          componentsXml.map((component: IXml): IRelationship => {\r\n            return {\r\n              type: 'feature-elementmanifest',\r\n              target: component.filename\r\n            };\r\n          })\r\n        ).concat( (resources.localizedResourcePaths.length > 0) ?\r\n          resources.localizedResourcePaths.map((filename: string) => {\r\n            return {\r\n              type: 'content-resource',\r\n              target: filename\r\n            };\r\n          })\r\n          : []\r\n        ).concat( (resources.defaultResourcePath)\r\n          ? {\r\n              type: 'content-defaultresource',\r\n              target: resources.defaultResourcePath\r\n          }\r\n          : []\r\n        ).concat(createAssetRelationships(assets))\r\n  );\r\n\r\n  return {\r\n    filename: featureXml.filename,\r\n    xml: featureXml.xml,\r\n    relationships: relationshipsXml,\r\n    config: configXml,\r\n    components: componentsXml,\r\n    assets\r\n  };\r\n}\r\n\r\nfunction createAssetRelationships(assets: ISharepointAssets<IXml>): IRelationship[] {\r\n  let relationships: IRelationship[] = [];\r\n  if (assets) {\r\n    relationships = relationships.concat(\r\n      createAssetRelationship('feature-elementfile', assets.elementFiles),\r\n      createAssetRelationship('feature-elementmanifest', assets.elementManifests),\r\n      createAssetRelationship('feature-upgradeactions', assets.upgradeActions)\r\n    );\r\n  }\r\n  return relationships;\r\n}\r\n\r\nfunction createAssetRelationship(type: string, files: IXml[]): IRelationship[] {\r\n  return files.map((file) => {\r\n    return {\r\n      type,\r\n      target: file.filename\r\n    };\r\n  });\r\n}"],"sourceRoot":"..\\..\\..\\..\\src"}