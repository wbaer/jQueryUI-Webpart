// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
"use strict";
var child_process = require("child_process");
var os = require("os");
var stream_collator_1 = require("@microsoft/stream-collator");
var ErrorDetector_1 = require("./errorDetection/ErrorDetector");
var ErrorDetectionRules = require("./errorDetection/rules/index");
console.log('gulp2vs: Running in "' + process.cwd() + '"');
var errorDetector = new ErrorDetector_1.default([
    ErrorDetectionRules.TsErrorDetector,
    ErrorDetectionRules.TsLintErrorDetector
]);
var writer = stream_collator_1.Interleaver.registerTask('vs gulp');
var gulpBundle = child_process.exec('gulp');
gulpBundle.stdout.on('data', function (data) {
    writer.write(data);
});
gulpBundle.stderr.on('data', function (data) {
    writer.writeError(data);
});
gulpBundle.on('exit', function (code) {
    var errors = errorDetector.execute(writer.getStdOutput());
    for (var i = 0; i < errors.length; i++) {
        writer.writeError(errors[i].toString(ErrorDetector_1.ErrorDetectionMode.VisualStudio) + os.EOL);
    }
    writer.writeLine('gulp2vs: Done.');
    writer.close();
    if (errors.length) {
        process.exit(1);
    }
});

//# sourceMappingURL=gulp2vs.js.map
