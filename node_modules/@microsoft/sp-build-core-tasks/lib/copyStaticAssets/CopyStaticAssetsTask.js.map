{"version":3,"sources":["copyStaticAssets/CopyStaticAssetsTask.ts"],"names":[],"mappings":";;;;;;AACA,2BAA6B;AAC7B,mFAA4E;AAC5E,wCAA2C;AAE3C,kDAA6C;AAS7C;;;;;;;;;;;;;;;;;;;;GAoBG;AACH;IAA0C,wCAAyC;IAAnF;QAAA,qEAiDC;QAhDQ,UAAI,GAAW,oBAAoB,CAAC;QACpC,gBAAU,GAAgC;YAC/C,iBAAiB,EAAE,EAAE;YACrB,iBAAiB,EAAE,EAAE;YACrB,YAAY,EAAE,EAAE;YAChB,YAAY,EAAE,EAAE;SACjB,CAAC;;IA0CJ,CAAC;IAxCQ,yCAAU,GAAjB;QACE,MAAM,CAAC,OAAO,CAAC,kCAAkC,CAAC,CAAC;IACrD,CAAC;IAEM,0CAAW,GAAlB,UAAmB,IAAe,EAAE,gBAA0C;QAC5E,IAAM,QAAQ,GAAW,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,KAAK,CAAC,CAAC;QACnG,IAAM,OAAO,GAAW,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,SAAS,IAAI,KAAK,CAAC,CAAC;QAElG,IAAM,YAAY,GAAa,EAAE,CAAC;QAElC,IAAM,aAAa,GAAa,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,MAAM,CAAC,qCAAc,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC;QAE3G,GAAG,CAAC,CAAY,UAAa,EAAb,+BAAa,EAAb,2BAAa,EAAb,IAAa;YAAxB,IAAI,GAAG,sBAAA;YACV,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1D,MAAM,CAAC,CAAC,8CAA8C;YACxD,CAAC;YAED,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBACtB,GAAG,GAAG,MAAI,GAAK,CAAC;YAClB,CAAC;YAED,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,EAAE,MAAI,UAAU,CAAC,GAAG,CAAG,CAAC,CAAC,CAAC;SACrE;QAED,GAAG,CAAC,CAAe,UAA4B,EAA5B,KAAA,IAAI,CAAC,UAAU,CAAC,YAAY,EAA5B,cAA4B,EAA5B,IAA4B;YAA1C,IAAM,IAAI,SAAA;YACb,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBACtD,MAAM,CAAC,CAAC,yCAAyC;YACnD,CAAC;YAED,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;SAC9C;QAED,GAAG,CAAC,CAAe,UAA4B,EAA5B,KAAA,IAAI,CAAC,UAAU,CAAC,YAAY,EAA5B,cAA4B,EAA5B,IAA4B;YAA1C,IAAM,IAAI,SAAA;YACb,YAAY,CAAC,IAAI,CAAC,MAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAG,CAAC,CAAC;SACpD;QAED,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC;aACrC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACxB,EAAE,CAAC,QAAQ,EAAE,cAAM,OAAA,gBAAgB,EAAE,EAAlB,CAAkB,CAAC,CAAC;IACrD,CAAC;IACH,2BAAC;AAAD,CAjDA,AAiDC,CAjDyC,sBAAY,GAiDrD;AAjDY,oDAAoB","file":"copyStaticAssets/CopyStaticAssetsTask.js","sourcesContent":["import * as gulp from 'gulp';\r\nimport * as path from 'path';\r\nimport { fileLoaderExts } from './../configureWebpack/ConfigureWebpackTask';\r\nimport globEscape = require('glob-escape');\r\n\r\nimport OdspGulpTask from './../OdspGulpTask';\r\n\r\nexport interface ICopyStaticAssetsTaskConfig {\r\n  includeExtensions?: string[];\r\n  excludeExtensions?: string[];\r\n  includeFiles?: string[];\r\n  excludeFiles?: string[];\r\n}\r\n\r\n/**\r\n * Configures the @microsoft/gulp-core-build-webpack task with some smart defaults based on the package configuration.\r\n *\r\n * Example:\r\n *  IN:\r\n *    setConfig({\r\n *      includeExtensions: ['template.html'],\r\n *      excludeExtensions: ['png'],\r\n *      includeFiles: ['/assets/goodAsset.png'],\r\n *      excludeFiles: ['/assets/badAsset.gif']\r\n *    })\r\n *\r\n *  OUT:\r\n *    copies all files that match our standard webpack file-loader extensions\r\n *      ('jpg', 'png', 'woff', 'eot', 'ttf', 'svg', 'gif'), with the following extensions, in the following order of\r\n *    precedence (from lowest to highest):\r\n *      1. including additional extensions (i.e. 'template.html')\r\n *      2. excluding specific extensions (i.e. 'png')\r\n *      3. including specific globs (i.e. '/assets/goodAsset.png')\r\n *      4. excluding specific globs (i.e. '/assets/badAsset.gif')\r\n */\r\nexport class CopyStaticAssetsTask extends OdspGulpTask<ICopyStaticAssetsTaskConfig> {\r\n  public name: string = 'copy-static-assets';\r\n  public taskConfig: ICopyStaticAssetsTaskConfig = {\r\n    includeExtensions: [],\r\n    excludeExtensions: [],\r\n    includeFiles: [],\r\n    excludeFiles: []\r\n  };\r\n\r\n  public loadSchema(): Object {\r\n    return require('./copy-static-assets.schema.json');\r\n  }\r\n\r\n  public executeTask(gulp: gulp.Gulp, completeCallback: (error?: string) => void): NodeJS.ReadWriteStream {\r\n    const rootPath: string = path.join(this.buildConfig.rootPath, this.buildConfig.srcFolder || 'src');\r\n    const libPath: string = path.join(this.buildConfig.rootPath, this.buildConfig.libFolder || 'lib');\r\n\r\n    const globPatterns: string[] = [];\r\n\r\n    const allExtensions: string[] = this.taskConfig.includeExtensions.concat(fileLoaderExts, ['json', 'html']);\r\n\r\n    for (let ext of allExtensions) {\r\n      if (this.taskConfig.excludeExtensions.indexOf(ext) !== -1) {\r\n        return; // Skipping this extension. It's been excluded\r\n      }\r\n\r\n      if (!ext.match(/^\\./)) {\r\n        ext = `.${ext}`;\r\n      }\r\n\r\n      globPatterns.push(path.join(rootPath, '**', `*${globEscape(ext)}`));\r\n    }\r\n\r\n    for (const file of this.taskConfig.includeFiles) {\r\n      if (this.taskConfig.excludeFiles.indexOf(file) !== -1) {\r\n        return; // Skipping this file. It's been excluded\r\n      }\r\n\r\n      globPatterns.push(path.join(rootPath, file));\r\n    }\r\n\r\n    for (const file of this.taskConfig.excludeFiles) {\r\n      globPatterns.push(`!${path.join(rootPath, file)}`);\r\n    }\r\n\r\n    return gulp.src(globPatterns, { base: rootPath })\r\n               .pipe(gulp.dest(libPath))\r\n               .on('finish', () => completeCallback());\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}