{"version":3,"sources":["configureWebpack/ConfigureWebpackTask.ts"],"names":[],"mappings":"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","file":"configureWebpack/ConfigureWebpackTask.js","sourcesContent":["import * as lodash from 'lodash';\r\nimport * as gulp from 'gulp';\r\nimport * as path from 'path';\r\nimport * as webpack from 'webpack';\r\nimport { WebpackTask } from '@microsoft/gulp-core-build-webpack';\r\nimport { ISetWebpackPublicPathLoaderOptions }\r\n  from '@microsoft/loader-set-webpack-public-path/lib/SetWebpackPublicPathLoader';\r\nimport { IClientSideComponentManifest } from '@microsoft/sp-module-interfaces';\r\n\r\nimport { getExternalsKeys } from './ExternalsProcessor';\r\nimport { ConfigureExternalBundlingWebpackTask } from './ConfigureExternalBundlingWebpackTask';\r\nimport OdspGulpTask, { ILocaleMap } from './../OdspGulpTask';\r\nimport constants from './../constants';\r\n\r\nexport interface IConfigureWebpackTaskConfig {\r\n  webpack?: WebpackTask;\r\n  webpackPublicPathOptions?: ISetWebpackPublicPathLoaderOptions;\r\n  libraryName?: string;\r\n  libraryTarget?: string;\r\n  configureExternalBundlingWebpackTask?: ConfigureExternalBundlingWebpackTask;\r\n\r\n  /**\r\n   * An optional callback can be provided that allows the generated webpack configuration to be modified.\r\n   */\r\n  additionalConfiguration?: (generatedConfiguration: webpack.Configuration) => webpack.Configuration;\r\n\r\n  /**\r\n   * An optional list of linked externals to include. For example, if you want to bundle react, list \"react\" in this\r\n   *  array. This is only designed to be used in very special cases and is not intended to be used regularly.\r\n   */\r\n  linkedExternalsToBundle?: string[];\r\n}\r\n\r\nexport interface IConfigEntry {\r\n  entry: string;\r\n  manifest: string;\r\n  outputPath: string;\r\n  stringsExternalName?: string;\r\n}\r\n\r\nexport interface IBundleEntry {\r\n  configEntry: IConfigEntry;\r\n  entryName: string;\r\n  nonLocalizedEntrypointPath?: string;\r\n  localizedEntrypointPaths?: ILocaleMap;\r\n  manifest: IClientSideComponentManifest;\r\n}\r\n\r\nexport function getBundleId(manifest: IClientSideComponentManifest, version: string = undefined): string {\r\n  return `${manifest.id}_${version || manifest.version}`;\r\n}\r\n\r\nconst supportedWebpackLibraryTargets: string[] = ['var', 'this', 'commonjs', 'commonjs2', 'amd', 'umd'];\r\n\r\nexport const fileLoaderExts: string[] = ['jpg', 'png', 'woff', 'eot', 'ttf', 'svg', 'gif'];\r\n\r\nconst isRunningInNpmMode: boolean = process.argv.indexOf('--npm') !== -1;\r\n\r\n/**\r\n * Configures the @microsoft/gulp-core-build-webpack task with some smart defaults based on the package configuration.\r\n *\r\n * Example:\r\n *  IN:\r\n *    setConfig({\r\n *      webpack: <reference to webpack task>,\r\n *      webpackPublicPathOptions: <options for @microsoft/loader-set-webpack-public-path>,\r\n *      libraryName: <optional library name - set this if the library should be a global on the window>,\r\n *      configureExternalBundlingWebpackTask: <optional reference to ConfigureExternalBundlingWebpackTask task>\r\n *    })\r\n *    buildConfig.properties.entries = [{\r\n *      \"entry\": \"./lib/App.js\",\r\n *      \"manifest\": \"./src/app.manifest.json\",\r\n *      \"outputPath\": \"dist/app.bundle.js\"\r\n *    }]\r\n *    buildConfig.properties.externals = {\r\n *      \"react-dom\": \"node_modules/react-dom/dist/react-dom.js\",\r\n *      \"react\": \"node_modules/react/dist/react.js\",\r\n *      \"flux\": \"node_modules/flux/dist/flux.js\",\r\n *    }\r\n *\r\n *  OUT:\r\n *    set webpack config to:\r\n *    {\r\n *        context: ... root path ...,\r\n *        entry: { ... mapping of names to entries ... },\r\n *        resolveLoader: {\r\n *          alias: undefined,\r\n *          root: ... node_modules ...\r\n *        },\r\n *        resolve: {\r\n *          extensions: ['', '.tsx', '.ts', '.jsx', '.js', '.less', '.css', '.html'],\r\n *          modulesDirectories: [ ... root path + /node_modules ],\r\n *          alias: { }\r\n *        },\r\n *        output: {\r\n *          library: <library name, if provided>,\r\n *          libraryTarget: <library target, if specified> or 'amd',\r\n *          path: ... dist folder ...,\r\n *          publicPath: this.taskConfig.publicPath,\r\n *          filename: PRODUCTION ? '[name]_[chunkhash].js' : '[name].js'\r\n *        },\r\n *        externals: [ ... externals names ... ],\r\n *        module: {\r\n *          preLoaders: [],\r\n *          noParse: [ /\\.map$/ ],\r\n *          loaders: [\r\n *            {\r\n *              test: /\\.module.scss$/,\r\n *              loader:\r\n *                'load-themed-styles!css-loader?&modules&localIdentName=[name]__[local]___[hash:base64:5]'\r\n *            },\r\n *            {\r\n *              test: /\\.scss$/, exclude: /\\.module.scss$/,\r\n *              loader: 'load-themed-styles!css-loader'\r\n *            },\r\n *            {\r\n *              test: /\\.(jpg|png|woff|eot|ttf|svg|gif)$/,\r\n *              loader: '@microsoft/loader-cased-file?name=[name]_[hash].[ext]'\r\n *            }\r\n *          ]\r\n *        },\r\n *        plugins: []\r\n *      }\r\n */\r\nexport class ConfigureWebpackTask extends OdspGulpTask<IConfigureWebpackTaskConfig> {\r\n  public name: string = 'configure-webpack';\r\n  public taskConfig: IConfigureWebpackTaskConfig = {\r\n    libraryName: undefined,\r\n    webpack: undefined,\r\n    webpackPublicPathOptions: undefined,\r\n    additionalConfiguration: undefined,\r\n    configureExternalBundlingWebpackTask: undefined\r\n  };\r\n\r\n  private _baseConfig: webpack.Configuration = {\r\n    module: {\r\n      loaders: [\r\n        {\r\n          loader: '@microsoft/loader-load-themed-styles!css-loader?-minimize',\r\n          test: /\\.css$/\r\n        },\r\n        {\r\n          loader: '@microsoft/loader-cased-file?name=[name:lower]_[hash].[ext]',\r\n          test: new RegExp(`\\.(${fileLoaderExts.map((e: string) => lodash.escapeRegExp(e)).join('|')})((\\\\?|\\\\#).+)?$`)\r\n        },\r\n        {\r\n          loader: 'json-loader',\r\n          test: /\\.json$/\r\n        },\r\n        {\r\n          loader: 'html-loader',\r\n          test: /\\.html$/\r\n        }\r\n      ],\r\n      noParse: [ /\\.map$/ ],\r\n      postLoaders: [],\r\n      preLoaders: []\r\n    },\r\n    resolve: {\r\n      alias: {},\r\n      modulesDirectories: [\r\n        '',\r\n        'node_modules',\r\n        'lib'\r\n      ]\r\n    },\r\n    resolveLoader: {\r\n      alias: undefined,\r\n      root: path.join(__dirname, '..', '..', 'node_modules'),\r\n      moduleTemplates: ['@microsoft/loader-*']\r\n    }\r\n  };\r\n\r\n  public loadSchema(): Object {\r\n    return require('./configure-webpack.schema.json');\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    // Get the webpack default configuration\r\n    const defaultConfig: webpack.Configuration = {};\r\n    (new (webpack as any).WebpackOptionsDefaulter()).process(defaultConfig); // tslint:disable-line:no-any\r\n\r\n    // Include the default moduleTemplates, if there are any defaults\r\n    if (defaultConfig.resolveLoader &&\r\n        defaultConfig.resolveLoader.moduleTemplates &&\r\n        !!defaultConfig.resolveLoader.moduleTemplates.length) {\r\n      this._baseConfig.resolveLoader.moduleTemplates.push(...defaultConfig.resolveLoader.moduleTemplates);\r\n    }\r\n  }\r\n\r\n  public setConfig(config: IConfigureWebpackTaskConfig): void {\r\n    if (config.webpack && config.webpack.name !== 'webpack') {\r\n      this.logWarning('Setting webpack property to non-\"@microsoft/gulp-core-build-webpack\"-type will ' +\r\n                      'prevent configuration');\r\n    }\r\n\r\n    super.mergeConfig(config);\r\n  }\r\n\r\n  public getKarmaConfig(\r\n    postLoaders: webpack.Loader[],\r\n    externals: webpack.ExternalsElement[]): webpack.Configuration {\r\n    const testAddons: webpack.Configuration = {\r\n      externals: externals,\r\n      module: {\r\n        loaders: [{\r\n          loader: 'imports?define=>false',\r\n          test: /sinon\\.js$/\r\n        }],\r\n        postLoaders: postLoaders\r\n      },\r\n      plugins: [new webpack.DefinePlugin({\r\n        DEBUG: !this.buildConfig.production,\r\n        UNIT_TEST: true,\r\n        NPM_BUILD: false,\r\n        BUILD_NUMBER: '\\'unit_test\\''\r\n      })],\r\n      resolve: {\r\n        alias: {}\r\n      }\r\n    };\r\n\r\n    return this._appendToBaseConfig(testAddons);\r\n  }\r\n\r\n  public executeTask(gulp: gulp.Gulp, completeCallback: (error?: string) => void): NodeJS.ReadWriteStream {\r\n    if (!this.taskConfig.webpack) {\r\n      this.logWarning('\"webpack\" is not defined in the task configuration. Nothing to configure.');\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    if (!this.buildConfig.properties) {\r\n      this._logNoEntriesWarning();\r\n      this._setWebpackConfig({});\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    // If the library target is explicitly set, ensure that it's set to one of the valid webpack library targets.\r\n    if (this.taskConfig.libraryTarget && supportedWebpackLibraryTargets.indexOf(this.taskConfig.libraryTarget) === -1) {\r\n      this.logError(`\"${this.taskConfig.libraryTarget}\" is not a valid library target type.`);\r\n      completeCallback();\r\n      return;\r\n    }\r\n\r\n    // The ConfigureExternalBundlingWebpackTask will disable the second webpack task\r\n    // when doing a dev build or in a project without localized resources.\r\n    // This, however, breaks gulp serve. Therefore, we should ensure the webpack task is activated.\r\n    // @todo 261553 - this should be removed when we do this refactor\r\n    this.taskConfig.webpack.isEnabled = () => {\r\n      return true;\r\n    };\r\n\r\n    /* tslint:disable:typedef variable-name */\r\n    const StatsPlugin = require('webpack-stats-plugin');\r\n    const VisualizerPlugin = require('webpack-visualizer-plugin');\r\n    /* tslint:enable:typedef variable-name */\r\n\r\n    const entries: IConfigEntry[] = this.properties.entries || [];\r\n\r\n    const externalsKeys: string[] = getExternalsKeys(this);\r\n\r\n    // Remove the specified linked externals to ensure they're bundled\r\n    if (this.taskConfig.linkedExternalsToBundle && this.taskConfig.linkedExternalsToBundle.length) {\r\n      for (const linkedExternalToBundle of this.taskConfig.linkedExternalsToBundle) {\r\n        const linkedExternalToBundleIndex: number = externalsKeys.indexOf(linkedExternalToBundle);\r\n        if (linkedExternalToBundleIndex !== -1) {\r\n          externalsKeys.splice(linkedExternalToBundleIndex, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    const localizedResources: { [name: string]: string } = this.properties.localizedResources || {};\r\n    const localizedResourcesKeys: string[] = Object.keys(localizedResources);\r\n\r\n    if (entries.length === 0) {\r\n      this._logNoEntriesWarning();\r\n    }\r\n\r\n    this.logVerbose(`${entries.length} entries specified.`);\r\n    this.logVerbose(`${externalsKeys.length} externals specified.`);\r\n    this.logVerbose(`${localizedResourcesKeys.length} localized resources specified.`);\r\n\r\n    localizedResourcesKeys.forEach((key: string) => {\r\n      if (externalsKeys.indexOf(key) !== -1) {\r\n        this.logError(`Invalid Configuration: Key \"${key}\" is specified in both externals and localizedResources.`);\r\n      }\r\n    });\r\n\r\n    const webpackPublicPathOptions: ISetWebpackPublicPathLoaderOptions =\r\n        lodash.clone(this.taskConfig.webpackPublicPathOptions) || {};\r\n    if (!webpackPublicPathOptions.systemJs) {\r\n      lodash.merge(webpackPublicPathOptions, {\r\n        scriptPath: constants.defaultWebpackPublicPathScriptName\r\n      });\r\n    }\r\n\r\n    const setWebpackPublicPath = require('@microsoft/loader-set-webpack-public-path'); // tslint:disable-line:typedef\r\n    setWebpackPublicPath.setOptions(webpackPublicPathOptions);\r\n\r\n    // When we loop through the config entries, record the manifests so we can use them later if we need to\r\n    const manifests: IClientSideComponentManifest[] = [];\r\n\r\n    this.properties.bundleEntries = [];\r\n    const webpackEntries: { [name: string]: string } = {};\r\n    for (const entry of entries) {\r\n      const entryName: string = path.basename(entry.outputPath, '.js');\r\n      webpackEntries[entryName] = path.join(this.buildConfig.rootPath, entry.entry);\r\n\r\n      const manifest: IClientSideComponentManifest = this.getManifest(entry.manifest);\r\n      this.properties.bundleEntries.push({\r\n        entryName,\r\n        configEntry: entry,\r\n        nonLocalizedEntrypointPath: path.join(this.outputDirectory, `${entryName}.js`),\r\n        manifest\r\n      });\r\n\r\n      if (manifest) {\r\n        manifests.push(manifest);\r\n      }\r\n    }\r\n\r\n    this.properties.webpackLibraryName = this.taskConfig.libraryName || (() => {\r\n      if (manifests.length === 0) {\r\n        // If there are no manifests, it doesn't appear as though we're generating a bundle that will be\r\n        //  loaded on the page, because the module loader requires an ID, so we shouldn't need to worry about\r\n        //  collisions in the webpackJsonp function.\r\n        return undefined;\r\n      } else if (manifests.length === 1) {\r\n        return getBundleId(manifests[0]);\r\n      } else {\r\n        // If there are multiple manifests, this is a project that is producing multiple components. Because\r\n        //  we need something unique for the webpack JSONP function, we'll just concatenate the IDs and then hash them.\r\n        //  In the post-bundle steps, we'll replace the \"define(<name>, ...\" name with the real IDs. When we update\r\n        //  this task to support multiple webpack configurations, we can seperate each bundle to have its own library\r\n        //  name.\r\n        const packageVersion: string = this.getPackageVersion();\r\n        this.properties.webpackLibraryNameIsTemporary = true;\r\n        return this.getChecksum(manifests.map(manifest => getBundleId(manifest, packageVersion)).join(''));\r\n      }\r\n    })();\r\n\r\n    const pathDirNames: string[] = this.buildConfig.rootPath.split(path.sep);\r\n    const lastDirName: string = pathDirNames[pathDirNames.length - 1] === ''\r\n      ? pathDirNames[pathDirNames.length - 2] : pathDirNames[pathDirNames.length - 1];\r\n    const configAddons: webpack.Configuration = {\r\n      context: this.buildConfig.rootPath,\r\n      devtool: this.buildConfig.production ? undefined : 'source-map',\r\n      entry: webpackEntries,\r\n      externals: externalsKeys.concat(localizedResourcesKeys),\r\n      module: {\r\n        preLoaders: [\r\n          {\r\n            test:   /\\.js$/,\r\n            loader: 'source-map-loader'\r\n          }]\r\n      },\r\n      output: {\r\n        chunkFilename: '[id].[name]_[chunkhash].js',\r\n        filename: '[name].js',\r\n        library: this.properties.webpackLibraryName,\r\n        libraryTarget: this.taskConfig.libraryTarget || 'amd',\r\n        path: this.outputDirectory,\r\n        devtoolModuleFilenameTemplate: 'webpack:///../[resource-path]',\r\n        devtoolFallbackModuleFilenameTemplate: 'webpack:///../[resource-path]?[hash]'\r\n      },\r\n      plugins: [\r\n        new StatsPlugin.StatsWriterPlugin({\r\n          fields: null, // tslint:disable-line:no-null-keyword\r\n          filename: path.join('..', this.buildConfig.tempFolder, `stats`, `${lastDirName}.stats.json`)\r\n        }),\r\n        new VisualizerPlugin({\r\n          filename: path.join('..', this.buildConfig.tempFolder, `stats`, `${lastDirName}.stats.html`)\r\n        })\r\n      ]\r\n    };\r\n\r\n    if (this.buildConfig.production) {\r\n      configAddons.plugins.push(new webpack.optimize.UglifyJsPlugin({\r\n        compress: {\r\n          dead_code: true,\r\n          warnings: false\r\n        },\r\n        mangle: true\r\n      }));\r\n    }\r\n\r\n    let buildNumber: string = undefined;\r\n    if (process.env.BUILD_BUILDNUMBER) {\r\n      buildNumber = `\\'${process.env.BUILD_BUILDNUMBER.toLowerCase()}\\'`;\r\n    }\r\n\r\n    configAddons.plugins.push(new webpack.DefinePlugin({\r\n      DEBUG: !this.buildConfig.production,\r\n      UNIT_TEST: false,\r\n      NPM_BUILD: isRunningInNpmMode,\r\n      BUILD_NUMBER: buildNumber\r\n    }));\r\n\r\n    if (externalsKeys.indexOf('office-ui-fabric-react') !== -1) {\r\n      // IFF 'office-ui-fabric-react' is an external, include a loader to translate deep fabric references to\r\n      // references to the top-level exports\r\n      if (!configAddons.module) {\r\n        configAddons.module = {};\r\n      }\r\n\r\n      if (!configAddons.module.preLoaders) {\r\n        configAddons.module.preLoaders = [];\r\n      }\r\n\r\n      configAddons.module.preLoaders.push({\r\n        test: /office-ui-fabric-react/,\r\n        loader: path.join(__dirname, 'loaders', 'FabricWorkaroundLoader')\r\n      });\r\n    }\r\n\r\n    let config: webpack.Configuration = this._appendToBaseConfig(configAddons);\r\n    if (this.taskConfig.configureExternalBundlingWebpackTask) {\r\n      this.taskConfig.configureExternalBundlingWebpackTask.tinkerWithBaseWebpackConfig(config);\r\n    }\r\n\r\n    if (this.taskConfig.additionalConfiguration) {\r\n      config = this.taskConfig.additionalConfiguration(config);\r\n    }\r\n\r\n    this._setWebpackConfig(config);\r\n\r\n    completeCallback();\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Modify the localized webpack config to make sure the end result is correct.\r\n   *\r\n   * @internal\r\n   */\r\n  public tinkerWithLocConfig(config: webpack.Configuration): void {\r\n    config.output.libraryTarget = this.taskConfig.libraryTarget || 'amd';\r\n  }\r\n\r\n  private _appendToBaseConfig(config: webpack.Configuration): webpack.Configuration {\r\n    return lodash.mergeWith({}, this._baseConfig, config, (value1: any, value2: any) => { // tslint:disable-line:no-any\r\n      if (lodash.isArray(value1) && lodash.isArray(value2)) {\r\n        return lodash.concat(value1, value2);\r\n      } else {\r\n        return undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  private _logNoEntriesWarning(): void {\r\n    // @TODO: SPPPlat VSO 221536\r\n    // this.logWarning('No entries are defined, so no bundles will be produced.');\r\n  }\r\n\r\n  private _setWebpackConfig(config: webpack.Configuration): void {\r\n    const webpackTask: WebpackTask = this.taskConfig.webpack;\r\n    const sourceMapWarningSupression: RegExp = /Cannot find SourceMap \\'.+\\'\\: Error\\:/;\r\n    const suppressedWarnings: (string | RegExp)[] = webpackTask.taskConfig.suppressWarnings || [];\r\n\r\n    if (webpackTask) {\r\n      webpackTask.setConfig({\r\n        config: config,\r\n        configPath: null, // tslint:disable-line:no-null-keyword\r\n        suppressWarnings: suppressedWarnings.concat([sourceMapWarningSupression])\r\n      });\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}