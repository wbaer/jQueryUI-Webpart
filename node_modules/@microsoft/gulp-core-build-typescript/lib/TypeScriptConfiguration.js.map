{"version":3,"sources":["TypeScriptConfiguration.ts"],"names":[],"mappings":"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","file":"TypeScriptConfiguration.js","sourcesContent":["import * as path from 'path';\r\nimport assign = require('object-assign');\r\nimport { SchemaValidator, IBuildConfig } from '@microsoft/gulp-core-build';\r\nimport ts = require('gulp-typescript');\r\nimport * as typescript from 'typescript';\r\n\r\nexport interface ITsConfigFile<T> {\r\n  compilerOptions: T;\r\n}\r\n\r\n/* tslint:disable:no-any */\r\n/*\r\n * A helper class which provides access to the TSConfig.json file for a particular project.\r\n * It also is a central place for managing the version of typescript which this project\r\n * should be built with.\r\n */\r\nexport class TypeScriptConfiguration {\r\n  private static _baseTsConfig: ITsConfigFile<ts.Settings>;\r\n  private static _typescript: any = require('typescript');\r\n\r\n  /**\r\n   * Gets `gulp-typescript` version of the config (used by TypeScriptTask)\r\n   * Returns a new object each time.\r\n   */\r\n  public static getGulpTypescriptOptions(buildConfig: IBuildConfig): ITsConfigFile<ts.Settings> {\r\n    const file: ITsConfigFile<ts.Settings> = assign({}, this._getTsConfigFile(buildConfig));\r\n    assign(file.compilerOptions, {\r\n      rootDir: buildConfig.rootPath,\r\n      typescript: this.getTypescriptCompiler()\r\n    });\r\n    return file;\r\n  }\r\n\r\n  /*\r\n   * Gets the `typescript` version of the config (used by ApiExtractorTask)\r\n   * Note: these differ slightly from the values in the tsconfig.json\r\n   * Returns a new object each time.\r\n   *\r\n   * Specifically, the issue in the difference between:\r\n   *    typescript.CompilerOptions\r\n   *               &\r\n   *          ts.Settings\r\n   *\r\n   * Insofar as `ts.Settings` accepts (and requires) enums for certain options, rather than strings.\r\n   * The clearest example is `moduleResolution` below.\r\n   */\r\n  public static getTypescriptOptions(buildConfig: IBuildConfig): ITsConfigFile<typescript.CompilerOptions> {\r\n    const oldConfig: ITsConfigFile<ts.Settings> = this.getGulpTypescriptOptions(buildConfig);\r\n    const newConfig: ITsConfigFile<typescript.CompilerOptions> = oldConfig as any;\r\n\r\n    delete newConfig.compilerOptions.moduleResolution;\r\n\r\n    /**\r\n     * Attempt to index into the enum to determine which target.\r\n     */\r\n    const scriptTarget: { [module: string]: typescript.ScriptTarget } = {\r\n      'es2015': typescript.ScriptTarget.ES2015,\r\n      'es2016': typescript.ScriptTarget.ES2016,\r\n      'es2017': typescript.ScriptTarget.ES2017,\r\n      'es3': typescript.ScriptTarget.ES3,\r\n      'es5': typescript.ScriptTarget.ES5,\r\n      'exnext': typescript.ScriptTarget.ESNext,\r\n      'latest': typescript.ScriptTarget.Latest\r\n    };\r\n    if (typeof oldConfig.compilerOptions.target === 'string') {\r\n      const target: string = oldConfig.compilerOptions.target.toLowerCase();\r\n      newConfig.compilerOptions.target = scriptTarget[target];\r\n\r\n      if (!newConfig.compilerOptions.target) {\r\n        throw new Error(`Invalid setting found in tsconfig.json: target: '${target}' to be one of: `\r\n         + Object.keys(scriptTarget).toString());\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Map the string in the tsconfig.json file to an enum for the typescript API\r\n     */\r\n    const moduleKind: { [module: string]: typescript.ModuleKind } = {\r\n      'commonjs': typescript.ModuleKind.CommonJS,\r\n      'amd': typescript.ModuleKind.AMD,\r\n      'es2015': typescript.ModuleKind.ES2015,\r\n      'none': typescript.ModuleKind.None,\r\n      'system': typescript.ModuleKind.System,\r\n      'umd': typescript.ModuleKind.UMD\r\n    };\r\n\r\n    if (typeof oldConfig.compilerOptions.module === 'string') {\r\n      const module: string = oldConfig.compilerOptions.module as string;\r\n      newConfig.compilerOptions.module = moduleKind[module.toLowerCase()];\r\n\r\n      if (!newConfig.compilerOptions.module) {\r\n        throw new Error(`Invalid setting found in tsconfig.json: Expected module: '${module}' to be one of: `\r\n          + Object.keys(moduleKind).toString());\r\n      }\r\n    }\r\n\r\n    return newConfig;\r\n  }\r\n\r\n  /**\r\n   * Override the version of the typescript compiler\r\n   */\r\n  public static setTypescriptCompiler(typescript: any): void {\r\n    if (this._typescript) {\r\n      throw new Error('The version of the typescript compiler should only be set once.');\r\n    }\r\n    if (this._baseTsConfig) {\r\n      throw new Error('Set the version of the typescript compiler before tasks call getConfig()');\r\n    }\r\n    this._typescript = typescript;\r\n  }\r\n\r\n  /**\r\n   * Get the version of the typescript compiler which is to be used\r\n   */\r\n  public static getTypescriptCompiler(): any {\r\n    if (!this._typescript) {\r\n      return require('typescript');\r\n    }\r\n    return this._typescript;\r\n  }\r\n\r\n  /**\r\n   * Helper function which reads the tsconfig.json (or provides one), and memoizes it\r\n   */\r\n  private static _getTsConfigFile(config: IBuildConfig): ITsConfigFile<ts.Settings> {\r\n    if (!this._baseTsConfig) {\r\n      try {\r\n        this._baseTsConfig = SchemaValidator.readCommentedJsonFile<any>(\r\n          this._getConfigPath(config)\r\n        );\r\n      } catch (e) {\r\n        /* no-op */\r\n      }\r\n\r\n      if (!this._baseTsConfig) {\r\n        this._baseTsConfig = {\r\n          compilerOptions: {\r\n            declaration: true,\r\n            experimentalDecorators: true,\r\n            jsx: 'react',\r\n            moduleResolution: 'node',\r\n            sourceMap: true,\r\n            target: 'es5',\r\n            noUnusedParameters: true,\r\n            noUnusedLocals: true\r\n          }\r\n        };\r\n      }\r\n    }\r\n    return this._baseTsConfig;\r\n  }\r\n\r\n  /**\r\n   * Extracts the path to the tsconfig.json based on the buildConfiguration\r\n   */\r\n  private static _getConfigPath(buildConfig: IBuildConfig): string {\r\n    return path.resolve(path.join(buildConfig.rootPath, 'tsconfig.json'));\r\n  }\r\n}"],"sourceRoot":"..\\src"}