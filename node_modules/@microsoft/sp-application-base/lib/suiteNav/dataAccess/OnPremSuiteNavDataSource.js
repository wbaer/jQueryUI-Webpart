"use strict";
var SuiteNavManager_1 = require("../SuiteNavManager");
var ISuiteNavDataSource_1 = require("./ISuiteNavDataSource");
var sp_telemetry_1 = require("@ms/sp-telemetry");
var sp_http_1 = require("@microsoft/sp-http");
var OnPremSuiteNavDataSource = (function () {
    function OnPremSuiteNavDataSource(httpClient, currentUICultureName, webServerRelativeUrl) {
        this.suiteNavService = ISuiteNavDataSource_1.SuiteNavSource.OnPrem;
        this._currentUICultureName = currentUICultureName;
        this._spHttpClient = httpClient;
        this._siteRelUrl = webServerRelativeUrl === '/' ? '' : webServerRelativeUrl;
    }
    OnPremSuiteNavDataSource.prototype.loadData = function () {
        var _this = this;
        var url = this._siteRelUrl
            + '/_api/Microsoft.SharePoint.Portal.SuiteNavData.GetSuiteNavData?v=2&Locale='
            + this._currentUICultureName;
        return this._spHttpClient.get(url, sp_http_1.SPHttpClient.configurations.v1)
            .then(function (response) {
            if (response.status !== 200) {
                _this._logAndThrowSuiteNavLoadingError();
            }
            return response.json().then(function (jsonString) {
                if (jsonString.value === '') {
                    _this._logAndThrowSuiteNavLoadingError();
                }
                else {
                    var suiteNavResponse = JSON.parse(jsonString.value);
                    if (!suiteNavResponse.NavBarData.Dimensions) {
                        suiteNavResponse.NavBarData.Dimensions = { Top: SuiteNavManager_1.default._defaultSuiteNavHeight };
                    }
                    return suiteNavResponse;
                }
            });
        });
    };
    OnPremSuiteNavDataSource.prototype._logAndThrowSuiteNavLoadingError = function () {
        sp_telemetry_1._TraceLogger.logVerbose(OnPremSuiteNavDataSource._logSource, 'Failed to retrieve Hybrid SuiteNavData');
        throw new Error('Failed to retrieve Hybrid SuiteNavData');
    };
    return OnPremSuiteNavDataSource;
}());
OnPremSuiteNavDataSource._logSource = sp_telemetry_1._LogSource.create('OnPremSuiteNavDataSource');
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = OnPremSuiteNavDataSource;
