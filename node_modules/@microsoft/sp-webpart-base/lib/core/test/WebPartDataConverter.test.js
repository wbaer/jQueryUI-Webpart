"use strict";
var chai_1 = require("chai");
var WebPartDataConverter_1 = require("../WebPartDataConverter");
var wpdata = {
    id: 'cef86cc2-e8eb-4222-ac05-26b14ca6aa2c',
    instanceId: '2e895656-4fda-43d0-ad98-2a979daf5f41',
    title: 'test webpart data',
    description: 'this data is used to test web part data converter utility',
    dataVersion: '1.0',
    serverProcessedContent: {
        htmlStrings: {
            'bio': 'Everybody knows <b>John Doe</b>!',
            'website.description': '<p>This is the <a href="/blog">Doe\'s blog</a></p>'
        },
        links: {
            'website.url': 'johndoe.com'
        },
        imageSources: {}
    },
    properties: {
        'name': 'John Doe',
        'bio': undefined,
        'phone': '(101) 101-1010',
        'website': {
            'name': 'Doe\'s Blog',
            'url': undefined,
            'description': undefined
        }
    }
};
var wpdataEncoded = "{&quot;id&quot;:&quot;cef86cc2-e8eb-4222-ac05-26b14ca6aa2c&quot;,&quot;instanceId&quot;:&quot;2e895656-4fda-43d0-ad98-2a979daf5f41&quot;,&quot;title&quot;:&quot;test webpart data&quot;,&quot;description&quot;:&quot;this data is used to test web part data converter utility&quot;,&quot;dataVersion&quot;:&quot;1.0&quot;,&quot;properties&quot;:{&quot;name&quot;:&quot;John Doe&quot;,&quot;phone&quot;:&quot;(101) 101-1010&quot;,&quot;website&quot;:{&quot;name&quot;:&quot;Doe's Blog&quot;}}}";
var htmlPropsString = "<div data-sp-prop-name=\"bio\">" + wpdata.serverProcessedContent.htmlStrings['bio'] + "</div>" +
    ("<div data-sp-prop-name=\"website.description\">" + wpdata.serverProcessedContent.htmlStrings['website.description'] + "</div>") +
    ("<a data-sp-prop-name=\"website.url\" href=\"" + wpdata.serverProcessedContent.links['website.url'] + "\"></a>");
var wphtml = "<div data-sp-webpart=\"\" data-sp-webpartdataversion=\"1.0\" data-sp-webpartdata=\"" + wpdataEncoded + "\">" +
    '<div data-sp-componentid="">cef86cc2-e8eb-4222-ac05-26b14ca6aa2c</div>' +
    ("<div data-sp-htmlproperties=\"\">" + htmlPropsString + "</div>") +
    '</div>';
var loopbackWpdata = {
    id: 'cef86cc2-e8eb-4222-ac05-26b14ca6aa2c',
    instanceId: '2e895656-4fda-43d0-ad98-2a979daf5f41',
    title: 'test webpart data',
    description: 'this data is used in loopback test for web part data converter',
    dataVersion: '1.0',
    serverProcessedContent: {
        htmlStrings: {
            'htmlString1': "<div></div>",
            'htmlstring2': "<div class=\"c1\" style=\"color:red;font-size:12px\"><a href=\"#\">Link</a><strong>bold</strong><div>some</div></div>"
        },
        links: {
            'link1': 'https://bing.com'
        },
        imageSources: {}
    },
    properties: {
        'encodedHtmlString': '&lt;div class=&#39;c1&#39; style=&#39;color:red;font-size:12px&#39;&gt;&lt;a href=&#39;#&#39;&gt;Link&lt;/a&gt;&lt;strong&gt;bold&lt;/string&gt;&lt;div&gt;some&lt;/div&gt;&lt;/div&gt;',
        'htmlWithNoMetadata': '<div>Html that is not marked as html in metadata</div>'
    }
};
var loopbackHtml = "<div data-sp-webpart=\"\" data-sp-webpartdataversion=\"1.0\" data-sp-webpartdata=\"{&quot;id&quot;:&quot;cef86cc2-e8eb-4222-ac05-26b14ca6aa2c&quot;,&quot;instanceId&quot;:&quot;2e895656-4fda-43d0-ad98-2a979daf5f41&quot;,&quot;title&quot;:&quot;test webpart data&quot;,&quot;description&quot;:&quot;this data is used in loopback test for web part data converter&quot;,&quot;dataVersion&quot;:&quot;1.0&quot;,&quot;properties&quot;:{&quot;encodedHtmlString&quot;:&quot;&amp;amp;lt;div class=&amp;amp;#39;c1&amp;amp;#39; style=&amp;amp;#39;color:red;font-size:12px&amp;amp;#39;&amp;amp;gt;&amp;amp;lt;a href=&amp;amp;#39;#&amp;amp;#39;&amp;amp;gt;Link&amp;amp;lt;/a&amp;amp;gt;&amp;amp;lt;strong&amp;amp;gt;bold&amp;amp;lt;/string&amp;amp;gt;&amp;amp;lt;div&amp;amp;gt;some&amp;amp;lt;/div&amp;amp;gt;&amp;amp;lt;/div&amp;amp;gt;&quot;,&quot;htmlWithNoMetadata&quot;:&quot;&amp;lt;div&gt;Html that is not marked as html in metadata&amp;lt;/div&gt;&quot;}}\"><div data-sp-componentid=\"\">cef86cc2-e8eb-4222-ac05-26b14ca6aa2c</div><div data-sp-htmlproperties=\"\"><div data-sp-prop-name=\"htmlString1\"><div></div></div><div data-sp-prop-name=\"htmlstring2\"><div class=\"c1\" style=\"color:red;font-size:12px\"><a href=\"#\">Link</a><strong>bold</strong><div>some</div></div></div><a data-sp-prop-name=\"link1\" href=\"https://bing.com\"></a></div></div>";
function assertEqualJsons(act, exp) {
    chai_1.assert.deepEqual(JSON.parse(JSON.stringify(act)), JSON.parse(JSON.stringify(exp)));
}
describe('WebPartDataConverter tests', function () {
    it('converts server-processed data to html', function () {
        chai_1.assert.equal(WebPartDataConverter_1.default.convertServerProcessedDataToHtml(wpdata.serverProcessedContent), htmlPropsString);
    });
    it('converts html to server-processed data', function () {
        assertEqualJsons(WebPartDataConverter_1.default.convertServerProcessedHtmlToData(htmlPropsString), wpdata.serverProcessedContent);
    });
    it('converts IWebPartData instance to persisted html', function () {
        chai_1.assert.equal(WebPartDataConverter_1.default.convertWebPartDataToHtml(wpdata), wphtml);
    });
    it('converts web part persisted html to IWebPartData instance', function () {
        assertEqualJsons(WebPartDataConverter_1.default.convertHtmlToWebPartData(wphtml), wpdata);
    });
    it('loopback test: IWebPartData -> Html -> IWebPartData', function () {
        var html = WebPartDataConverter_1.default.convertWebPartDataToHtml(loopbackWpdata);
        assertEqualJsons(WebPartDataConverter_1.default.convertHtmlToWebPartData(html), loopbackWpdata);
    });
    it('loopback test: Html -> IWebPartData -> Html', function () {
        var data = WebPartDataConverter_1.default.convertHtmlToWebPartData(loopbackHtml);
        assertEqualJsons(WebPartDataConverter_1.default.convertWebPartDataToHtml(data), loopbackHtml);
    });
});
