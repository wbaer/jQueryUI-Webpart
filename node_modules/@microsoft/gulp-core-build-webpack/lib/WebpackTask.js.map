{"version":3,"sources":["WebpackTask.ts"],"names":[],"mappings":"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","file":"WebpackTask.js","sourcesContent":["import * as Webpack from 'webpack';\r\nimport { GulpTask, IBuildConfig } from '@microsoft/gulp-core-build';\r\nimport gulp = require('gulp');\r\nimport { EOL } from 'os';\r\n\r\nexport interface IWebpackTaskConfig {\r\n  /**\r\n   * Path to a webpack config. A path to a config takes precidence over the \"config\" option.\r\n   */\r\n  configPath: string;\r\n\r\n  /**\r\n   * Webpack config object. If a path is specified by \"configPath,\" and it is valid, this option is ignored.\r\n   */\r\n  config?: Webpack.Configuration;\r\n\r\n  /**\r\n   * An array of regular expressions or regular expression strings. If a warning matches any of them, it\r\n   * will not be logged.\r\n   */\r\n  suppressWarnings?: (string | RegExp)[];\r\n\r\n  /**\r\n   * An instance of the webpack compiler object, useful for building with Webpack 2.X while GCB is still on 1.X.\r\n   */\r\n  webpack?: typeof Webpack;\r\n}\r\n\r\nexport class WebpackTask extends GulpTask<IWebpackTaskConfig> {\r\n  public name: string = 'webpack';\r\n\r\n  public taskConfig: IWebpackTaskConfig = {\r\n    configPath: './webpack.config.js',\r\n    suppressWarnings: []\r\n  };\r\n\r\n  public get resources(): Object {\r\n    if (!this._resources) {\r\n      this._resources = {\r\n        webpack: require('webpack')\r\n      };\r\n    }\r\n    return this._resources;\r\n  }\r\n\r\n  private _resources: Object;\r\n\r\n  public isEnabled(buildConfig: IBuildConfig): boolean {\r\n    return (\r\n      super.isEnabled(buildConfig) &&\r\n      this.taskConfig.configPath !== null // tslint:disable-line:no-null-keyword\r\n    );\r\n  }\r\n\r\n  public loadSchema(): Object {\r\n    return require('./webpack.schema.json');\r\n  }\r\n\r\n  public executeTask(gulp: gulp.Gulp, completeCallback: (result?: Object) => void): void {\r\n    const shouldInitWebpack: boolean = (process.argv.indexOf('--initwebpack') > -1);\r\n\r\n    /* tslint:disable:typedef */\r\n    const path = require('path');\r\n    /* tslint:enabled:typedef */\r\n\r\n    if (shouldInitWebpack) {\r\n      this.log(\r\n        'Initializing a webpack.config.js, which bundles lib/index.js ' +\r\n        'into dist/packagename.js into a UMD module.');\r\n\r\n      this.copyFile(path.resolve(__dirname, '..', 'webpack.config.js'));\r\n      completeCallback();\r\n    } else {\r\n      let webpackConfig: Object;\r\n\r\n      if (this.taskConfig.configPath && this.fileExists(this.taskConfig.configPath)) {\r\n        try {\r\n          webpackConfig = require(this.resolvePath(this.taskConfig.configPath));\r\n        } catch (err) {\r\n          completeCallback(`Error parsing webpack config: ${this.taskConfig.configPath}: ${err}`);\r\n          return;\r\n        }\r\n      } else if (this.taskConfig.config) {\r\n        webpackConfig = this.taskConfig.config;\r\n      } else {\r\n        this._logMissingConfigWarning();\r\n        completeCallback();\r\n        return;\r\n      }\r\n\r\n      if (webpackConfig) {\r\n        const webpack: Webpack.Webpack = this.taskConfig.webpack || require('webpack');\r\n        const gutil = require('gulp-util');\r\n        const startTime = new Date().getTime();\r\n        const outputDir = this.buildConfig.distFolder;\r\n\r\n        webpack(\r\n          webpackConfig,\r\n          (error, stats) => {\r\n            if (!this.buildConfig.properties) {\r\n              this.buildConfig.properties = {};\r\n            }\r\n\r\n            /* tslint:disable:no-string-literal */\r\n            this.buildConfig.properties['webpackStats'] = stats;\r\n            /* tslint:enable:no-string-literal */\r\n\r\n            const statsResult = stats.toJson({\r\n              hash: false,\r\n              source: false\r\n            });\r\n\r\n            if (statsResult.errors && statsResult.errors.length) {\r\n              this.logError(`'${outputDir}':` + EOL + statsResult.errors.join(EOL) + EOL);\r\n            }\r\n\r\n            if (statsResult.warnings && statsResult.warnings.length) {\r\n              const unsuppressedWarnings: string[] = [];\r\n              const warningSuppressonRegexes = (this.taskConfig.suppressWarnings || []).map((regex: string) => {\r\n                return new RegExp(regex);\r\n              });\r\n\r\n              statsResult.warnings.forEach((warning: string) => {\r\n                let suppressed = false;\r\n                for (let i = 0; i < warningSuppressonRegexes.length; i++) {\r\n                  const suppressionRegex = warningSuppressonRegexes[i];\r\n                  if (warning.match(suppressionRegex)) {\r\n                    suppressed = true;\r\n                    break;\r\n                  }\r\n                }\r\n\r\n                if (!suppressed) {\r\n                  unsuppressedWarnings.push(warning);\r\n                }\r\n              });\r\n\r\n              if (unsuppressedWarnings.length > 0) {\r\n                this.logWarning(`'${outputDir}':` + EOL + unsuppressedWarnings.join(EOL) + EOL);\r\n              }\r\n            }\r\n\r\n            const duration = (new Date().getTime() - startTime);\r\n            const statsResultChildren = statsResult.children ? statsResult.children : [statsResult];\r\n\r\n            statsResultChildren.forEach(child => {\r\n              if (child.chunks) {\r\n                child.chunks.forEach(chunk => {\r\n                  if (chunk.files) {\r\n                    chunk.files.forEach(file => (\r\n                      this.log(`Bundled: '${gutil.colors.cyan(path.basename(file))}', ` +\r\n                        `size: ${gutil.colors.magenta(chunk.size)} bytes, ` +\r\n                        `took ${gutil.colors.magenta(duration)} ms.`)\r\n                    )); // end file\r\n                  }\r\n                }); // end chunk\r\n              }\r\n            }); // end child\r\n\r\n            completeCallback();\r\n          }); // endwebpack callback\r\n      }\r\n    }\r\n  }\r\n\r\n  private _logMissingConfigWarning() {\r\n    this.logWarning(\r\n      'No webpack config has been provided. ' +\r\n      'Run again using --initwebpack to create a default config, ' +\r\n      `or call webpack.setConfig({ configPath: null }) in your gulpfile.`);\r\n  }\r\n}\r\n"],"sourceRoot":"..\\src"}